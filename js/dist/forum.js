(()=>{var n={n:s=>{var o=s&&s.__esModule?()=>s.default:()=>s;return n.d(o,{a:o}),o},d:(s,o)=>{for(var e in o)n.o(o,e)&&!n.o(s,e)&&Object.defineProperty(s,e,{enumerable:!0,get:o[e]})},o:(n,s)=>Object.prototype.hasOwnProperty.call(n,s),r:n=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})}},s={};(()=>{"use strict";n.r(s);const o=flarum.core.compat["forum/app"];var e=n.n(o);const t=flarum.core.compat["common/extend"],a=flarum.core.compat["common/components/Button"];var r=n.n(a);const i=flarum.core.compat["common/components/Link"];var c=n.n(i);const u=flarum.core.compat["common/components/LinkButton"];var p=n.n(u);const d=flarum.core.compat["common/components/LoadingIndicator"];var l=n.n(d);const f=flarum.core.compat["common/components/Select"];var v=n.n(f);const L=flarum.core.compat["common/components/FieldSet"];var O=n.n(L);const g=flarum.core.compat["common/helpers/icon"];var y=n.n(g);const h=flarum.core.compat["forum/components/DiscussionListItem"];var R=n.n(h);const w=flarum.core.compat["forum/components/DiscussionPage"];var b=n.n(w);const k=flarum.core.compat["forum/components/SettingsPage"];var P=n.n(k);function S(n,s){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},S(n,s)}const _=flarum.core.compat["common/components/Alert"];var N=function(n){var s,o;function e(){return n.apply(this,arguments)||this}return o=n,(s=e).prototype=Object.create(o.prototype),s.prototype.constructor=s,S(s,o),e.initAttrs=function(n){if(n.ondismiss2){var s=n.ondismiss||function(){};n.ondismiss=function(){s(),n.ondismiss2()}}},e}(n.n(_)());function j(){var n,s;return(null==(n=e().session.user)||null==(s=n.preferences())?void 0:s.discussionOpenLastRead)||e().forum.attribute("discussionOpenLastReadDefault")}e().initializers.add("discussion-open-position",(function(){(0,t.extend)(R().prototype,"view",(function(n){if(!this.attrs.params.q){var s=j();if("always"!==s){var o=this.attrs.discussion;n.children.forEach((function(n){n&&n.attrs&&n.attrs.className&&-1!==n.attrs.className.indexOf("DiscussionListItem-content")&&n.children.forEach((function(n){if(n&&n.tag===c()){var t=0;"unread"===s&&o.isUnread()&&(t=Math.min(o.lastPostNumber(),(o.lastReadPostNumber()||0)+1)),n.attrs.href=e().route.discussion(o,t)}}))}))}}})),(0,t.extend)(b().prototype,"show",(function(n,s){var o;if(e().session.user&&e().forum.attribute("discussionOpenLastReadPrompt")&&(null==(o=e().session.user.preferences())||!o.discussionOpenLastRead)){var t=e().forum.attribute("discussionOpenLastReadDefault");if("unread"!==t&&0!==s.replyCount())var a="always"===t?"never":"always",i=[r().component({className:"Button Button--link",onclick:function(){e().session.user.savePreferences({discussionOpenLastRead:a}).then((function(){e().alerts.dismiss(c)}))}},e().translator.trans("clarkwinkelmann-discussion-open-position.forum.firstTimePrompt.openLastOptions."+a)),p().component({className:"Button Button--link",href:e().route("settings"),onclick:function(){e().alerts.dismiss(c)}},e().translator.trans("clarkwinkelmann-discussion-open-position.forum.firstTimePrompt.more"))],c=e().alerts.show(N,{type:"info",controls:i,ondismiss2:function(){e().session.user.savePreferences({discussionOpenLastRead:t})}},e().translator.trans("clarkwinkelmann-discussion-open-position.forum.firstTimePrompt.from"+("always"===t?"Always":"Never")))}})),(0,t.extend)(P().prototype,"settingsItems",(function(n){var s=this,o=j();n.add("discussionOpenLastRead",O().component({label:e().translator.trans("clarkwinkelmann-discussion-open-position.forum.preferences.discussionOpenLastRead"),className:"Settings-discussionOpenLastRead"},[m(".Form-group",[v().component({options:{always:e().translator.trans("clarkwinkelmann-discussion-open-position.forum.preferences.openLastOptions.always"),unread:e().translator.trans("clarkwinkelmann-discussion-open-position.forum.preferences.openLastOptions.unread"),never:e().translator.trans("clarkwinkelmann-discussion-open-position.forum.preferences.openLastOptions.never")},value:o,onchange:function(n){s.discussionOpenLastReadLoading="saving",s.user.savePreferences({discussionOpenLastRead:n}).then((function(){s.discussionOpenLastReadLoading="saved",m.redraw(),setTimeout((function(){s.discussionOpenLastReadLoading=null,m.redraw()}),2e3)})).catch((function(n){throw s.discussionOpenLastReadLoading="error",m.redraw(),n}))},disabled:"saving"===this.discussionOpenLastReadLoading},e().translator.trans("flarum-subscriptions.forum.settings.follow_after_reply_label")),"saving"===this.discussionOpenLastReadLoading?m("span.Settings-discussionOpenLastRead-state",l().component({display:"inline"})):null,"saved"===this.discussionOpenLastReadLoading?m("span.Settings-discussionOpenLastRead-state.Settings-discussionOpenLastRead-saved",y()("fas fa-check")):null,"error"===this.discussionOpenLastReadLoading?m("span.Settings-discussionOpenLastRead-state.Settings-discussionOpenLastRead-error",y()("fas fa-exclamation-circle")):null])]))}))}))})(),module.exports=s})();
//# sourceMappingURL=forum.js.map