(()=>{var n={n:s=>{var e=s&&s.__esModule?()=>s.default:()=>s;return n.d(e,{a:e}),e},d:(s,e)=>{for(var t in e)n.o(e,t)&&!n.o(s,t)&&Object.defineProperty(s,t,{enumerable:!0,get:e[t]})},o:(n,s)=>Object.prototype.hasOwnProperty.call(n,s),r:n=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})}},s={};(()=>{"use strict";n.r(s);const e=flarum.core.compat["forum/app"];var t=n.n(e);const o=flarum.core.compat["common/extend"],a=flarum.core.compat["common/components/Button"];var r=n.n(a);const i=flarum.core.compat["common/components/Link"];var c=n.n(i);const u=flarum.core.compat["common/components/LinkButton"];var d=n.n(u);const l=flarum.core.compat["common/components/LoadingIndicator"];var p=n.n(l);const f=flarum.core.compat["common/components/Select"];var v=n.n(f);const g=flarum.core.compat["common/components/FieldSet"];var L=n.n(g);const O=flarum.core.compat["common/helpers/icon"];var b=n.n(O);const y=flarum.core.compat["forum/components/DiscussionListItem"];var h=n.n(y);const R=flarum.core.compat["forum/components/DiscussionPage"];var w=n.n(R);const k=flarum.core.compat["forum/components/SettingsPage"];var P=n.n(k);function S(n,s){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},S(n,s)}const _=flarum.core.compat["common/components/Alert"];var x=function(n){var s,e;function t(){return n.apply(this,arguments)||this}return e=n,(s=t).prototype=Object.create(e.prototype),s.prototype.constructor=s,S(s,e),t.initAttrs=function(n){if(n.ondismiss2){var s=n.ondismiss||function(){};n.ondismiss=function(){s(),n.ondismiss2()}}},t}(n.n(_)());function N(){var n,s;return(null==(n=t().session.user)||null==(s=n.preferences())?void 0:s.discussionOpenLastRead)||t().forum.attribute("discussionOpenLastReadDefault")}t().initializers.add("discussion-open-position",(function(){(0,o.extend)(h().prototype,"view",(function(n){if(!this.attrs.params.q){var s=N();if("always"!==s){var e=this.attrs.discussion;n.children.forEach((function(n){n&&n.attrs&&n.attrs.className&&-1!==n.attrs.className.indexOf("DiscussionListItem-content")&&n.children.forEach((function(n){if(n&&n.tag===c()){var o,a=0;"unread"===s&&e.isUnread()&&(a=Math.min(e.lastPostNumber()||0,(e.lastReadPostNumber()||0)+1)),o=function(n){if(!("v17development-blog"in flarum.extensions))return!1;var s="both"===t().forum.attribute("blogRedirectsEnabled")||"discussions_only"===t().forum.attribute("blogRedirectsEnabled"),e=n.tags()||[];if(s&&e.length>0){var o=t().forum.attribute("blogTags");return e.some((function(n){if(!n)return!1;var s=n.parent()||null;return-1!==o.indexOf(n.id())||s&&-1!==o.indexOf(s.id())}))}return!1}(e)?a>1?t().route("blogArticle.near",{id:e.slug(),near:a}):t().route("blogArticle",{id:e.slug()}):t().route.discussion(e,a),n.attrs.href=o}}))}))}}})),(0,o.extend)(w().prototype,"show",(function(n,s){var e;if(t().session.user&&t().forum.attribute("discussionOpenLastReadPrompt")&&(null==(e=t().session.user.preferences())||!e.discussionOpenLastRead)){var o=t().forum.attribute("discussionOpenLastReadDefault");if("unread"!==o&&0!==s.replyCount())var a="always"===o?"never":"always",i=[r().component({className:"Button Button--link",onclick:function(){t().session.user.savePreferences({discussionOpenLastRead:a}).then((function(){t().alerts.dismiss(c)}))}},t().translator.trans("clarkwinkelmann-discussion-open-position.forum.firstTimePrompt.openLastOptions."+a)),d().component({className:"Button Button--link",href:t().route("settings"),onclick:function(){t().alerts.dismiss(c)}},t().translator.trans("clarkwinkelmann-discussion-open-position.forum.firstTimePrompt.more"))],c=t().alerts.show(x,{type:"info",controls:i,ondismiss2:function(){t().session.user.savePreferences({discussionOpenLastRead:o})}},t().translator.trans("clarkwinkelmann-discussion-open-position.forum.firstTimePrompt.from"+("always"===o?"Always":"Never")))}})),(0,o.extend)(P().prototype,"settingsItems",(function(n){var s=this,e=N();n.add("discussionOpenLastRead",L().component({label:t().translator.trans("clarkwinkelmann-discussion-open-position.forum.preferences.discussionOpenLastRead"),className:"Settings-discussionOpenLastRead"},[m(".Form-group",[v().component({options:{always:t().translator.trans("clarkwinkelmann-discussion-open-position.forum.preferences.openLastOptions.always"),unread:t().translator.trans("clarkwinkelmann-discussion-open-position.forum.preferences.openLastOptions.unread"),never:t().translator.trans("clarkwinkelmann-discussion-open-position.forum.preferences.openLastOptions.never")},value:e,onchange:function(n){s.discussionOpenLastReadLoading="saving",s.user.savePreferences({discussionOpenLastRead:n}).then((function(){s.discussionOpenLastReadLoading="saved",m.redraw(),setTimeout((function(){s.discussionOpenLastReadLoading=null,m.redraw()}),2e3)})).catch((function(n){throw s.discussionOpenLastReadLoading="error",m.redraw(),n}))},disabled:"saving"===this.discussionOpenLastReadLoading},t().translator.trans("flarum-subscriptions.forum.settings.follow_after_reply_label")),"saving"===this.discussionOpenLastReadLoading?m("span.Settings-discussionOpenLastRead-state",p().component({display:"inline"})):null,"saved"===this.discussionOpenLastReadLoading?m("span.Settings-discussionOpenLastRead-state.Settings-discussionOpenLastRead-saved",b()("fas fa-check")):null,"error"===this.discussionOpenLastReadLoading?m("span.Settings-discussionOpenLastRead-state.Settings-discussionOpenLastRead-error",b()("fas fa-exclamation-circle")):null])]))}))}))})(),module.exports=s})();
//# sourceMappingURL=forum.js.map